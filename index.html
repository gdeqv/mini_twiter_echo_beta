<body style="background:#121212; color:#fff; font-family:sans-serif; margin:0; padding:0;">
<!-- –®–∞–ø–∫–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<div id="auth-buttons" style="padding:10px; display:flex; gap:10px; background:#1a1a1a;">
    <button onclick="signInWithGoogle()" style="padding:5px 10px;">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
    <button onclick="signOut()" style="padding:5px 10px;">–í—ã–π—Ç–∏</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –Ω–∏–∫–∞ -->
<div id="nickname-modal" style="
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.8); justify-content:center; align-items:center;">
    <div style="background:#222; padding:20px; border-radius:10px; text-align:center;">
        <h3>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –Ω–∏–∫</h3>
        <input type="text" id="nickname-input" placeholder="–í–∞—à –Ω–∏–∫" style="padding:5px; margin-top:10px;"/>
        <button onclick="saveNickname()" style="margin-top:10px; padding:5px 10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
</div>

<!-- –ù–æ–≤—ã–π –ø–æ—Å—Ç -->
<div id="new-post-container" style="margin:10px;">
    <input type="text" id="new-post-input" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?" style="width:70%; padding:5px;"/>
    <button onclick="addPost()" style="padding:5px 10px;">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
</div>

<!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
<div id="posts-tab" style="margin:10px;"></div>

<script>
let postsData = [];
let currentUser = null;

// Firebase –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
auth.onAuthStateChanged(user => {
    currentUser = user;
    if(user && !user.displayName){
        document.getElementById('nickname-modal').style.display='flex';
    }
    renderPosts();
});

function signInWithGoogle() {
    const provider = new firebase.auth.GoogleAuthProvider();
    firebase.auth().signInWithPopup(provider)
    .then(result => {
        currentUser = result.user;
        if(!currentUser.displayName){
            document.getElementById('nickname-modal').style.display='flex';
        }
        renderPosts();
    })
    .catch(err => alert(err.message));
}

function signOut() {
    firebase.auth().signOut().then(()=>{
        currentUser = null;
        renderPosts();
    });
}

function saveNickname() {
    const nick = document.getElementById('nickname-input').value.trim();
    if(!nick) return alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!');
    currentUser.updateProfile({displayName:nick}).then(()=>{
        document.getElementById('nickname-modal').style.display='none';
        renderPosts();
    });
}

function addPost() {
    if(!currentUser) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!');
    const input = document.getElementById('new-post-input');
    const text = input.value.trim();
    if(!text) return;
    const newPost = {
        id: postsData.length + 1,
        author: '@' + currentUser.displayName,
        text,
        likes:0,
        reposts:0,
        comments:[]
    };
    postsData.unshift(newPost);
    input.value='';
    renderPosts();
}

function renderPosts() {
    const container = document.getElementById('posts-tab');
    container.innerHTML='';
    postsData.forEach(post=>{
        const div = document.createElement('div');
        div.style.background='#1e1e1e';
        div.style.margin='10px 0';
        div.style.padding='10px';
        div.style.borderRadius='8px';
        div.innerHTML=`
            <h4>${post.author}</h4>
            <p>${post.text}</p>
            <button onclick="likePost(${post.id})">‚ù§ ${post.likes}</button>
            <button onclick="showComments(${post.id})">üí¨ ${post.comments.length}</button>
            <button onclick="repostPost(${post.id})">üîÅ ${post.reposts}</button>
            <div id="comments-${post.id}"></div>
        `;
        container.appendChild(div);
    });
}

function likePost(id){
    if(!currentUser) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!');
    const post = postsData.find(p=>p.id===id);
    post.likes++;
    renderPosts();
}

function repostPost(id){
    if(!currentUser) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!');
    const post = postsData.find(p=>p.id===id);
    post.reposts++;
    renderPosts();
}

function showComments(id){
    const post = postsData.find(p=>p.id===id);
    const div = document.getElementById(`comments-${id}`);
    if(div.style.display==='block'){ div.style.display='none'; return; }
    div.style.display='block';
    div.innerHTML = `<input type="text" id="comment-input-${id}" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"/><button onclick="addComment(${id})">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>`;
    post.comments.forEach(c=>{
        const cdiv = document.createElement('div');
        cdiv.textContent = `${c.author}: ${c.text}`;
        div.appendChild(cdiv);
    });
}

function addComment(id){
    if(!currentUser) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!');
    const post = postsData.find(p=>p.id===id);
    const input = document.getElementById(`comment-input-${id}`);
    const text = input.value.trim();
    if(!text) return;
    post.comments.push({author:'@'+currentUser.displayName, text});
    input.value='';
    showComments(id);
}
</script>
</body>
