<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Echo Beta</title>
<style>
body {
    margin:0;
    font-family:Arial, sans-serif;
    background-color:#111;
    color:#fff;
}
.container {
    max-width:400px;
    margin:20px auto;
    padding:20px;
    background-color:#222;
    border-radius:10px;
}
button {
    width:100%;
    padding:10px;
    margin:5px 0;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}
button:hover { opacity:0.9; }
input { width:100%; padding:10px; margin:10px 0; border-radius:5px; border:none; }
#error, #nick-error { color:#f55; font-size:0.9em; }

#nickname-modal {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background: rgba(0,0,0,0.9);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:1000;
}
#nickname-modal div {
    background: #222;
    padding:30px;
    border-radius:10px;
    width:300px;
    text-align:center;
}

#tabs {
    display:flex;
    justify-content:space-around;
    margin-bottom:10px;
}
.tab {
    flex:1;
    padding:10px;
    background:#333;
    text-align:center;
    cursor:pointer;
    border-radius:5px;
    margin:0 2px;
}
.tab.active { background:#0f0; color:#000; }

.post {
    background:#333;
    padding:10px;
    margin:10px 0;
    border-radius:8px;
}
.post h4 { margin:0 0 5px 0; }
.post p { margin:0 0 5px 0; }
.post button { width:auto; padding:5px 10px; margin-right:5px; }
.comments { margin-top:10px; padding-left:10px; border-left:2px solid #555; }
.comment { margin-bottom:5px; }
</style>
</head>
<body>

<div class="container" id="login-container">
    <h2>–í—Ö–æ–¥ –≤ Echo</h2>
    <button onclick="googleLogin()" style="background:#4285F4; color:#fff;">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>
    <div id="error"></div>
</div>

<div class="container" id="welcome-container" style="display:none;">
    <h2 id="welcome-msg"></h2>
    <button onclick="logout()">–í—ã–π—Ç–∏</button>

    <div id="tabs">
        <div class="tab active" onclick="switchTab('posts')">–ü–æ—Å—Ç—ã</div>
        <div class="tab" onclick="switchTab('reposts')">–†–µ–ø–æ—Å—Ç—ã</div>
    </div>

    <div id="posts-tab">
        <!-- –õ–µ–Ω—Ç–∞ –ø–æ—Å—Ç–æ–≤ -->
    </div>
    <div id="reposts-tab" style="display:none;">
        <!-- –õ–µ–Ω—Ç–∞ —Ä–µ–ø–æ—Å—Ç–æ–≤ -->
    </div>
</div>

<div id="nickname-modal">
    <div>
        <h2>–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–∏–∫</h2>
        <input type="text" id="nickname-input" placeholder="–ù–∏–∫">
        <button onclick="setNickname()" style="background:#0f0; color:#000;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∏–∫</button>
        <div id="nick-error"></div>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyDYNBFXBRNg68Z3u_T4JTa-kRqorWKtZek",
    authDomain: "echo-beta-edb51.firebaseapp.com",
    projectId: "echo-beta-edb51",
    storageBucket: "echo-beta-edb51.firebasestorage.app",
    messagingSenderId: "18552431523",
    appId: "1:18552431523:web:7541c2d8f549dcb55cf016",
    measurementId: "G-XQ49S7VDS1"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL);

function googleLogin() {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider).catch(err => {
        document.getElementById('error').textContent = err.message;
    });
}

auth.onAuthStateChanged(user => {
    const loginContainer = document.getElementById('login-container');
    const welcomeContainer = document.getElementById('welcome-container');
    const welcomeMsg = document.getElementById('welcome-msg');
    const nicknameModal = document.getElementById('nickname-modal');

    if(user) {
        loginContainer.style.display = 'none';
        if(!user.displayName) {
            nicknameModal.style.display = 'flex';
            welcomeContainer.style.display = 'none';
        } else {
            nicknameModal.style.display = 'none';
            welcomeContainer.style.display = 'block';
            welcomeMsg.textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.displayName}!`;
        }
        renderPosts();
        renderReposts();
    } else {
        loginContainer.style.display = 'block';
        welcomeContainer.style.display = 'none';
        nicknameModal.style.display = 'none';
    }
});

function setNickname() {
    const nickInput = document.getElementById('nickname-input').value;
    const nickError = document.getElementById('nick-error');
    if(!nickInput) { nickError.textContent = "–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫!"; return; }
    const user = auth.currentUser;
    user.updateProfile({ displayName: nickInput }).then(() => {
        nickError.textContent = "";
        document.getElementById('nickname-modal').style.display = 'none';
        document.getElementById('welcome-container').style.display = 'block';
        document.getElementById('welcome-msg').textContent = `–ü—Ä–∏–≤–µ—Ç, ${user.displayName}!`;
    }).catch(err => { nickError.textContent = err.message; });
}

function logout() { auth.signOut(); }

let currentTab = 'posts';
function switchTab(tab) {
    currentTab = tab;
    document.getElementById('posts-tab').style.display = (tab==='posts') ? 'block':'none';
    document.getElementById('reposts-tab').style.display = (tab==='reposts') ? 'block':'none';
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    event.target.classList.add('active');
}

// –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
let postsData = [
    {id:1, author:'Alice', text:'–ü—Ä–∏–≤–µ—Ç, Echo!', likes:0, reposts:0, comments:[]},
    {id:2, author:'Bob', text:'–í—Ç–æ—Ä–æ–π –ø–æ—Å—Ç', likes:0, reposts:0, comments:[]},
];
let repostsData = [];

function renderPosts() {
    const container = document.getElementById('posts-tab');
    container.innerHTML = '';
    postsData.forEach(post=>{
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `<h4>${post.author}</h4><p>${post.text}</p>
        <button onclick="likePost(${post.id}, 'posts')">‚ù§ ${post.likes}</button>
        <button onclick="showComments(${post.id})">üí¨ ${post.comments.length}</button>
        <button onclick="repostPost(${post.id})">üîÅ ${post.reposts}</button>
        <div class="comments" id="comments-${post.id}"></div>`;
        container.appendChild(div);
    });
}

function renderReposts() {
    const container = document.getElementById('reposts-tab');
    container.innerHTML = '';
    repostsData.forEach(post=>{
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `<h4>${post.author}</h4><p>${post.text}</p>`;
        container.appendChild(div);
    });
}

function likePost(id, type) {
    if(!auth.currentUser) { alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!'); return; }
    let data = (type==='posts') ? postsData : repostsData;
    let post = data.find(p=>p.id===id);
    post.likes++;
    renderPosts();
}

function repostPost(id) {
    if(!auth.currentUser) { alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!'); return; }
    let post = postsData.find(p=>p.id===id);
    post.reposts++;
    repostsData.push({...post});
    renderReposts();
}

function showComments(id) {
    if(!auth.currentUser) { alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!'); return; }
    const post = postsData.find(p=>p.id===id);
    const commentsDiv = document.getElementById(`comments-${id}`);
    if(commentsDiv.querySelector('input')) return; // –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥–≤–∞–∂–¥—ã
    const commentInput = document.createElement('input');
    commentInput.placeholder = '–ù–∞–ø–∏—Å–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π';
    commentInput.style.width='100%';
    commentInput.onkeypress = function(e){
        if(e.key==='Enter' && commentInput.value.trim()!==''){
            post.comments.push({author:auth.currentUser.displayName,text:commentInput.value});
            renderPosts();
        }
    }
    commentsDiv.appendChild(commentInput);
}
</script>
</body>
</html>
