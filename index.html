<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Echo</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
  #posts { margin-top: 20px; }
  .post { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; cursor: pointer; }
  input, button { padding: 5px; margin: 5px 0; width: 100%; }
</style>
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
</head>
<body>
<h1>Echo</h1>

<div id="auth">
  <h2>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è / –í—Ö–æ–¥</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
  <button onclick="login()">–í–æ–π—Ç–∏</button>
</div>

<div id="app" style="display:none;">
  <button onclick="logout()">–í—ã–π—Ç–∏</button>
  <h2>–ù–æ–≤–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è</h2>
  <input id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?">
  <button onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>

  <div id="posts"></div>
</div>

<script>
  // üîë –ö–æ–Ω—Ñ–∏–≥ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDYNBFXBRNg68Z3u_T4JTa-kRqorWKtZek",
    authDomain: "echo-beta-edb51.firebaseapp.com",
    projectId: "echo-beta-edb51",
    storageBucket: "echo-beta-edb51.firebasestorage.app",
    messagingSenderId: "18552431523",
    appId: "1:18552431523:web:7541c2d8f549dcb55cf016",
    measurementId: "G-XQ49S7VDS1"
  };

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
  function register() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, password)
      .then(() => alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!"))
      .catch(e => alert(e.message));
  }

  // –í—Ö–æ–¥
  function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, password)
      .catch(e => alert(e.message));
  }

  // –í—ã—Ö–æ–¥
  function logout() {
    auth.signOut();
  }

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  auth.onAuthStateChanged(user => {
    if (user) {
      document.getElementById("auth").style.display = "none";
      document.getElementById("app").style.display = "block";
      loadPosts();
    } else {
      document.getElementById("auth").style.display = "block";
      document.getElementById("app").style.display = "none";
    }
  });

  // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
  function addPost() {
    const text = document.getElementById("postText").value;
    if (!text) return;
    db.collection("posts").add({
      text,
      uid: auth.currentUser.uid,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById("postText").value = "";
  }

  // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤
  function loadPosts() {
    db.collection("posts").orderBy("createdAt", "desc")
      .onSnapshot(snapshot => {
        const postsDiv = document.getElementById("posts");
        postsDiv.innerHTML = "";
        snapshot.docs.forEach(doc => {
          const data = doc.data();
          const div = document.createElement("div");
          div.className = "post";
          div.textContent = data.text;
          div.onclick = () => alert("–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –µ—â—ë –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã üòâ");
          postsDiv.appendChild(div);
        });
      });
  }
</script>
</body>
</html>
